<?xml version="1.0" encoding="iso-8859-1" ?>

<!--
================================================================================
Build file for Funambol J2ME Mail Client.
================================================================================
-->
<project name="Funambol J2ME Common" default="build" basedir="..">
    <!-- Define the tasks. -->
    <taskdef resource="antenna.properties"/>
    <!--
    ========================================================================
     Setting variable
    ========================================================================
    -->
    <target name="init">
        <tstamp>
            <format property="timestamp.MM" pattern="MM" />
            <format property="timestamp.dd" pattern="dd" />
            <format property="timestamp.HH" pattern="HH" />
        </tstamp>

        <property name="platform" value="j2me"/>

        <property name="dir.src"          value="${basedir}/src"             />
        <property name="dir.pdsrc"        value="${basedir}/pdsrc/${platform}"/>
        <property name="dir.test"         value="${basedir}/test"            />
        <property name="dir.res"          value="${basedir}/res"             />     
        <property name="dir.output"       value="${basedir}/output"          />    
        <property name="dir.docs"         value="${basedir}/docs"          />      
        <property name="dir.output.html"  value="${dir.output}/html"         />
        <property name="dir.classes"      value="${dir.output}/classes"      />
        <!-- WTK Definitions -->
        <property name="wtk.home"                value="C://tools//WTK2.5.1" />
        <property name="wtk.cldc.version"        value="1.0"      />
        <property name="wtk.midp.version"        value="2.0"      />
        <property name="wtk.midp_api"            value="${wtk.home}/lib/midpapi20.jar"/>
        <property name="wtk.optionalpda.enabled" value="true"     />
        <property name="wtk.debug"               value="false"                      />
    
        <!-- Standard SDK runtime environment parameters -->
        <property name="emu.device"           value="DefaultColorPhone"/>
        <property name="emu.heapsize"         value="700K"/>
        <property name="emu.wait"             value="true"/>

        <!-- WTK Definitions -->
        <property name="wtk.cldc.version"        value="1.0"/>
        <property name="wtk.midp.version"        value="2.0"/>
        <property name="wtk.optionalpda.enabled" value="false"/>
        <property name="wtk.wma.enabled"         value="true"/>
        <property name="wtk.debug"               value="false"/>
        <property name="wma.jar"                 value="${wtk.home}/lib/wma11.jar"/>
        <property name="mmapi.jar"               value="${wtk.home}/lib/mmapi.jar"/>

        <property name="libs.extra" value="" />
        <property name="lib.funambol.common" value="${basedir}/lib/funambol-j2me-common.jar"/>
    </target>

    
    <!-- =================================================================== -->
    <!-- COMPILE                                                             -->
    <!-- Compile the files                                                   -->
    <!-- ====================================================================-->
    <!-- Compile sources -->
    <target name="compile_single" depends="init">
        <mkdir dir="${dir.classes}"/>

        <wtkbuild srcdir="${dir.src}" destdir="${dir.classes}"
              target="1.1" source="1.2" preverify="false" debug="${wtk.debug}">
            <classpath>
                <pathelement location="${wma.jar}"/>
                <pathelement location="${libs.extra}"/>
                <pathelement location="${lib.funambol.common}"/>
            </classpath>
        </wtkbuild>
    </target>
    
    <!-- Compile test classes -->
    <target name="compile_test" depends="compile_single">
        <wtkbuild srcdir="test" destdir="${dir.classes}"
              target="1.1" source="1.2" preverify="false" debug="${wtk.debug}">
            <classpath>
                <pathelement location="${lib.junit}"/>
                <pathelement location="${wma.jar}"/>
                <pathelement location="${libs.extra}"/>
                <pathelement location="${lib.funambol.common}"/>
            </classpath>
            
        </wtkbuild>
    </target>
    
    <!-- =================================================================== -->
    <!-- RELEASE                                                             -->
    <!-- When a new release is created, the release.properties file is       -->
    <!-- updated with the current date and incrementing the build number.    -->
    <!-- ====================================================================-->
    <target name="release_single">
        <antcall target="compile_single"/>
        <antcall target="docs_single"/> <!-- public javadocs for release -->
        <zip zipfile="${dir.output}/${j2me.name}-${j2me.version}.zip">
            <zipfileset dir="." includes="**/*" excludes="CVS/, **/nbproject/"/>
        </zip>
        
    </target>


    <!-- =============================================== -->
    <!-- TEST                                            -->
    <!-- =============================================== -->
    <target name="test_single" depends="init">
        
        <!-- Unpack the dependent packages -->
        <unjar src="${lib.junit}" dest="${dir.classes}"/>
        <unjar src="${lib.funambol.common}" dest="${dir.classes}"/>
        <!--
        <copy todir="${dir.classes}/res">
            <fileset dir="${dir.res}" includes="*.properties" />
        </copy>
        -->
        <!-- Create a JAD file. -->
        
        <wtkjad jadfile="${dir.output}/MailTest.jad"
            jarfile="${dir.output}/MailTest.jar"
            name="MailTest"
            vendor="Funambol Inc."
            version="${j2me.version}">

            <midlet name="Address Test" class="com.funambol.mail.AddressTest"/>
            <midlet name="Folder Test" class="com.funambol.mail.FolderTest"/>
            <midlet name="MIMEFormatter Test" class="com.funambol.mail.MIMEFormatterTest"/>
            <midlet name="MIMEProcessor Test" class="com.funambol.mail.MIMEProcessorTest"/>
            <midlet name="MessageFlags Test" class="com.funambol.mail.MessageFlagsTest"/>
            <midlet name="Message Test" class="com.funambol.mail.MessageTest"/>
            <midlet name="RMSStore Test" class="com.funambol.mail.RMSStoreTest"/>
            <midlet name="StoreFactory Test" class="com.funambol.mail.StoreFactoryTest"/>
            <midlet name="LazyMessage Test" class="com.funambol.mail.LazyMessageTest"/>
        </wtkjad>
        
        <!-- Package everything. Most of the necessary information is
         contained in the JAD file. Also preverify the result this
         time. To obfuscate everything, set the corresponding
         parameter to "true" (requires RetroGuard or ProGuard). The
         version parameter increments the MIDlet-Version by one. -->
        
        <wtkpackage jarfile="${dir.output}/MailTest.jar"
            jadfile="${dir.output}/MailTest.jad"
            obfuscate="false"
            preverify="true" classpath="${wma.jar};${libs.extra}">
            
            
            <!-- Package our newly compiled classes. -->
            <fileset dir="${dir.classes}" includes="**/*.class"/>
            <!--<fileset file="${lib.junit}"/>-->
            
            <fileset dir="${dir.classes}" includes="res/*.properties" />
            
        </wtkpackage>
        
    </target>
    
    
    <!-- =============================================== -->
    <!-- DOCS                                            -->
    <!-- =============================================== -->
    <target name="docs_single" depends="init">
        
        <!--
        First of all copy all the files we want to document in a
        temporary directory, than apply javadoc
        -->
        
        <delete dir="${dir.docs}/javadoc/src"/>
        <mkdir dir="${dir.docs}/javadoc/src"/>
        
        <copy todir="${dir.docs}/javadoc/src">
            <fileset dir="${dir.src}/">
                
                <!--
                package com.funambol.mail
                -->
                <include name="com/funambol/mail/package.html"/>
                <include name="**/*.java"/>
            </fileset>
        </copy>
        
        
        <!--copy todir="${dir.docs}/javadoc" file="${dir.src}/docs/images/logo.gif"/-->
        
        
        <javadoc destdir      = "${dir.docs}/javadoc" packagenames="com.*"
             version      = "false"
             author       = "false"
             windowtitle  = "Funambol MAIL J2ME API ${j2me.version}">
            
            <classpath>
                <pathelement location="${wtk.midp_api}"/>
                <pathelement location="${dir.output}/${j2me.name}.jar"/>
                <pathelement location="${lib.funambol.common}"/>
            </classpath>
            
            <packageset dir="${dir.docs}/javadoc/src" defaultexcludes="yes">
                <include name="com/funambol/mail"/>
            </packageset>
            
            <doctitle>
                <![CDATA[<!--img src="logo.gif"--> <h1>Funambol J2ME Mail API ${j2me.version}</h1>]]>
            </doctitle>
            <bottom><![CDATA[<i>Copyright &#169; 2006 Funambol.</i>]]></bottom>
        </javadoc>
        <delete dir="${dir.docs}/javadoc/src"/>
    </target>
    
    <!-- =============================================== -->
    <!-- RUN                                             -->
    <!-- =============================================== -->
    <target name="runj2me" depends="init">
        <!-- Start the MIDlet suite -->
        <wtkrun jadfile="${dir.output}/MailTest.jad"
            device="DefaultColorPhone" wait="true">
        </wtkrun>
    </target>
    
    <!-- =============================================== -->
    <!-- DEBUG                                           -->
    <!-- =============================================== -->
    <target name="debug" depends="init">
        <wtkrun jadfile="${dir.output}/MailTest.jad"
            device="DefaultColorPhone" wait="true" debug="5000">
        </wtkrun>
    </target>
    

</project>

